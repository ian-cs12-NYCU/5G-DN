# 放在檔案最上方（在 http 層）
map $arg_since $feed_id {
    default "000";
    "~^(\d{1,3})$" $1;
}

server {
    listen 80;
    server_name _;
    root /data;

    location = / { try_files /index.html =404; }

    # 小上傳：POST 回 204
    location = /react {
        client_max_body_size 10m;
        if ($request_method = POST) { return 204; }
        return 405;
    }

    # /feed?since=xxx -> /data/feed/<末三碼>.json
    location = /feed {
        default_type application/json;
        add_header Cache-Control "no-store";
        try_files /feed/$feed_id.json =404;
    }

    # 影音段檔
    location /video/ {
        types { video/mp2t ts; }
        try_files $uri =404;
    }
}
